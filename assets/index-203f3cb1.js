var je=Object.defineProperty,Ve=Object.defineProperties;var He=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var Ye=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable;var ie=(e,l,n)=>l in e?je(e,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[l]=n,O=(e,l)=>{for(var n in l||(l={}))Ye.call(l,n)&&ie(e,n,l[n]);if(re)for(var n of re(l))Xe.call(l,n)&&ie(e,n,l[n]);return e},ue=(e,l)=>Ve(e,He(l));var oe=(e,l,n)=>new Promise((k,T)=>{var v=A=>{try{p(n.next(A))}catch(b){T(b)}},s=A=>{try{p(n.throw(A))}catch(b){T(b)}},p=A=>A.done?k(A.value):Promise.resolve(A.value).then(v,s);p((n=n.apply(e,l)).next())});import{an as Re,d as Ee,f as _e,ag as ze,c as I,w as $,Z as M,_ as U,u,N as qe,ab as m,a8 as W,a9 as j,E as de,a0 as he,a1 as fe,l as C,F as z,aa as Ge,ai as Je,aj as We,A as Ze,m as ye,r as pe,H as R,h as V,o as Qe,n as ke,z as ge,ac as et,i as tt}from"./vue-ea98dac5.js";import{au as nt,k as at,u as lt,$ as ct,I as Q,av as Se,K as st,aw as rt,a3 as it,ax as ut,Y as Ke,V as ot,r as xe}from"./index.js";import{aX as dt,aY as ht,aZ as ft,x as yt,a_ as pt,a$ as kt,D as gt,k as St,f as ee,b0 as Kt,o as xt,e as Z,G as Ct,am as vt,aE as Ce,ae as At,v as Lt,ai as ve}from"./antd-65489578.js";import{u as bt}from"./useContextMenu-52378380.js";function te(e,l){return l?typeof l=="string"?` ${e}--${l}`:Array.isArray(l)?l.reduce((n,k)=>n+te(e,k),""):Object.keys(l).reduce((n,k)=>n+(l[k]?te(e,k):""),""):""}function Et(e){return(l,n)=>(l&&typeof l!="string"&&(n=l,l=""),l=l?`${e}__${l}`:e,`${l}${te(l,n)}`)}function Te(e){return[Et(`${nt}-${e}`)]}const Ae=Symbol(),Le=Symbol();function _t(e,l){if(!ht(e)||e[Le])return e;const{values:n,required:k,default:T,type:v,validator:s}=e,p=n||s?A=>{let b=!1,L=[];if(n&&(L=[...n,T],b||(b=L.includes(A))),s&&(b||(b=s(A))),!b&&L.length>0){const h=[...new Set(L)].map(t=>JSON.stringify(t)).join(", ");Re(`Invalid prop: validation failed${l?` for prop "${l}"`:""}. Expected one of [${h}], got value ${JSON.stringify(A)}.`)}return b}:void 0;return{type:typeof v=="object"&&Object.getOwnPropertySymbols(v).includes(Ae)&&v?v[Ae]:v,required:!!k,default:T,validator:p,[Le]:!0}}const Tt=e=>dt(Object.entries(e).map(([l,n])=>[l,_t(n,l)]));var _=(e=>(e[e.SELECT_ALL=0]="SELECT_ALL",e[e.UN_SELECT_ALL=1]="UN_SELECT_ALL",e[e.EXPAND_ALL=2]="EXPAND_ALL",e[e.UN_EXPAND_ALL=3]="UN_EXPAND_ALL",e[e.CHECK_STRICTLY=4]="CHECK_STRICTLY",e[e.CHECK_UN_STRICTLY=5]="CHECK_UN_STRICTLY",e))(_||{});const Bt=["update:expandedKeys","update:selectedKeys","update:value","change","check","update:searchValue"],wt=Tt({value:{type:[Object,Array]},renderIcon:{type:Function},helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:Boolean,search:Boolean,searchValue:{type:String,default:""},checkStrictly:Boolean,clickRowToExpand:{type:Boolean,default:!1},checkable:Boolean,defaultExpandLevel:{type:[String,Number],default:""},defaultExpandAll:Boolean,fieldNames:{type:Object},treeData:{type:Array},actionList:{type:Array,default:()=>[]},expandedKeys:{type:Array},selectedKeys:{type:Array,default:()=>[]},checkedKeys:{type:[Array,Object],default:()=>[]},beforeRightClick:{type:Function,default:void 0},rightMenuList:{type:Array},filterFn:{type:Function,default:void 0},highlight:{type:[Boolean,String],default:!1},expandOnSearch:Boolean,checkOnSearch:Boolean,selectedOnSearch:Boolean,loading:{type:Boolean,default:!1},treeWrapperClassName:String}),Dt={key:2,class:"flex items-center flex-1 cursor-pointer justify-self-stretch"},Ft=Ee({__name:"TreeHeader",props:{helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},search:{type:Boolean,default:!1},searchText:{type:String,default:""},checkAll:{type:Function,default:void 0},expandAll:{type:Function,default:void 0}},emits:["strictly-change","search"],setup(e,{emit:l}){const n=e,k=_e(""),[T]=Te("tree-header"),v=ze(),{t:s}=at(),p=I(()=>["mr-1","w-full",{"ml-5":v.headerTitle||n.title}]),A=I(()=>{const{checkable:t}=n,c=[{label:s("component.tree.expandAll"),value:_.EXPAND_ALL},{label:s("component.tree.unExpandAll"),value:_.UN_EXPAND_ALL,divider:t}];return t?[{label:s("component.tree.selectAll"),value:_.SELECT_ALL},{label:s("component.tree.unSelectAll"),value:_.UN_SELECT_ALL,divider:t},...c,{label:s("component.tree.checkStrictly"),value:_.CHECK_STRICTLY},{label:s("component.tree.checkUnStrictly"),value:_.CHECK_UN_STRICTLY}]:c}),b=({key:t})=>{var c,r,d,o;switch(t){case _.SELECT_ALL:(c=n.checkAll)==null||c.call(n,!0);break;case _.UN_SELECT_ALL:(r=n.checkAll)==null||r.call(n,!1);break;case _.EXPAND_ALL:(d=n.expandAll)==null||d.call(n,!0);break;case _.UN_EXPAND_ALL:(o=n.expandAll)==null||o.call(n,!1);break;case _.CHECK_STRICTLY:l("strictly-change",!1);break;case _.CHECK_UN_STRICTLY:l("strictly-change",!0);break}};function L(t){l("search",t)}const h=lt(L,200);return $(()=>k.value,t=>{h(t)}),$(()=>n.searchText,t=>{t!==k.value&&(k.value=t)}),(t,c)=>(M(),U("div",{class:fe([u(T)(),"flex px-2 py-1.5 items-center"])},[u(v).headerTitle?qe(t.$slots,"headerTitle",{key:0}):m("",!0),!u(v).headerTitle&&t.title?(M(),W(u(ct),{key:1,helpMessage:t.helpMessage},{default:j(()=>[de(he(t.title),1)]),_:1},8,["helpMessage"])):m("",!0),t.search||t.toolbar?(M(),U("div",Dt,[t.search?(M(),U("div",{key:0,class:fe(p.value)},[C(u(ft),{placeholder:u(s)("common.searchText"),size:"small",allowClear:"",value:k.value,"onUpdate:value":c[0]||(c[0]=r=>k.value=r)},null,8,["placeholder","value"])],2)):m("",!0),t.toolbar?(M(),W(u(gt),{key:1,onClick:c[1]||(c[1]=Ze(()=>{},["prevent"]))},{overlay:j(()=>[C(u(yt),{onClick:b},{default:j(()=>[(M(!0),U(z,null,Ge(A.value,r=>(M(),U(z,{key:r.value},[C(u(pt),Je(We({key:r.value})),{default:j(()=>[de(he(r.label),1)]),_:2},1040),r.divider?(M(),W(u(kt),{key:0})):m("",!0)],64))),128))]),_:1})]),default:j(()=>[C(Q,{icon:"ion:ellipsis-vertical"})]),_:1})):m("",!0)])):m("",!0)],2))}}),Nt=({icon:e})=>e?St(e)?ye(Q,{icon:e,class:"mr-1"}):ye(Q):null;function Mt(e,l){function n(h){const t=[],c=h||u(e),{key:r,children:d}=u(l);if(!d||!r)return t;for(let o=0;o<c.length;o++){const i=c[o];t.push(i[r]);const y=i[d];y&&y.length&&t.push(...n(y))}return t}function k(h){const t=[],c=h||u(e),{key:r,children:d}=u(l);if(!d||!r)return t;for(let o=0;o<c.length;o++){const i=c[o];i.disabled!==!0&&i.selectable!==!1&&t.push(i[r]);const y=i[d];y&&y.length&&t.push(...k(y))}return t}function T(h,t){const c=[],r=t||u(e),{key:d,children:o}=u(l);if(!o||!d)return c;for(let i=0;i<r.length;i++){const y=r[i],E=y[o];h===y[d]?(c.push(y[d]),E&&E.length&&c.push(...n(E))):E&&E.length&&c.push(...T(h,E))}return c}function v(h,t,c){if(!h)return;const r=c||u(e),{key:d,children:o}=u(l);if(!(!o||!d))for(let i=0;i<r.length;i++){const y=r[i],E=y[o];if(y[d]===h){r[i]=O(O({},r[i]),t);break}else E&&E.length&&v(h,t,y[o])}}function s(h=1,t,c=1){if(!h)return[];const r=[],d=t||u(e)||[];for(let o=0;o<d.length;o++){const i=d[o],{key:y,children:E}=u(l),q=y?i[y]:"",P=E?i[E]:[];r.push(q),P&&P.length&&c<h&&(c+=1,r.push(...s(h,P,c)))}return r}function p({parentKey:h=null,node:t,push:c="push"}){const r=ee(u(e));if(!h){r[c](t),e.value=r;return}const{key:d,children:o}=u(l);!o||!d||(Se(r,i=>{if(i[d]===h)return i[o]=i[o]||[],i[o][c](t),!0}),e.value=r)}function A({parentKey:h=null,list:t,push:c="push"}){const r=ee(u(e));if(!(!t||t.length<1))if(h){const{key:d,children:o}=u(l);if(!o||!d)return;Se(r,i=>{if(i[d]===h){i[o]=i[o]||[];for(let y=0;y<t.length;y++)i[o][c](t[y]);return e.value=r,!0}})}else{for(let d=0;d<t.length;d++)r[c](t[d]);e.value=r;return}}function b(h,t){if(!h)return;const c=t||u(e),{key:r,children:d}=u(l);if(!(!d||!r))for(let o=0;o<c.length;o++){const i=c[o],y=i[d];if(i[r]===h){c.splice(o,1);break}else y&&y.length&&b(h,i[d])}}function L(h,t,c){if(!h&&h!==0)return null;const r=t||u(e),{key:d,children:o}=u(l);return d?(r.forEach(i=>{if(c!=null&&c.key||(c==null?void 0:c.key)===0)return c;if(i[d]===h){c=i;return}i[o]&&i[o].length&&(c=L(h,i[o],c))}),c||null):null}return{deleteNodeByKey:b,insertNodeByKey:p,insertNodesByKey:A,filterByLevel:s,updateNodeByKey:v,getAllKeys:n,getChildrenKeys:T,getEnabledKeys:k,getSelectedNode:L}}function be(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const Ut=Ee({name:"BasicTree",inheritAttrs:!1,props:wt,emits:Bt,setup(e,{attrs:l,slots:n,emit:k,expose:T}){const[v]=Te("tree"),s=pe({checkStrictly:e.checkStrictly,expandedKeys:e.expandedKeys||[],selectedKeys:e.selectedKeys||[],checkedKeys:e.checkedKeys||[]}),p=pe({startSearch:!1,searchText:"",searchData:[]}),A=_e([]),[b]=bt(),L=I(()=>{const{fieldNames:a}=e;return O({children:"children",title:"title",key:"key"},a)}),h=I(()=>{let a=ue(O(O({blockNode:!0},l),e),{expandedKeys:s.expandedKeys,selectedKeys:s.selectedKeys,checkedKeys:s.checkedKeys,checkStrictly:s.checkStrictly,fieldNames:u(L),"onUpdate:expandedKeys":f=>{s.expandedKeys=f,k("update:expandedKeys",f)},"onUpdate:selectedKeys":f=>{s.selectedKeys=f,k("update:selectedKeys",f)},onCheck:(f,S)=>{let g=R(s.checkedKeys);if(st(g)&&p.startSearch){const x=S.node.eventKey;g=Kt(g,q(x)),S.checked&&g.push(x),s.checkedKeys=g}else s.checkedKeys=f;const K=R(s.checkedKeys);k("update:value",K),k("check",K,S)},onRightClick:De});return xt(a,"treeData","class")}),t=I(()=>p.startSearch?p.searchData:u(A)),c=I(()=>!t.value||t.value.length===0),{deleteNodeByKey:r,insertNodeByKey:d,insertNodesByKey:o,filterByLevel:i,updateNodeByKey:y,getAllKeys:E,getChildrenKeys:q,getEnabledKeys:P,getSelectedNode:Be}=Mt(A,L);function we(a,f){return!f&&e.renderIcon&&Z(e.renderIcon)?e.renderIcon(a):f}function De(S){return oe(this,arguments,function*({event:a,node:f}){var F;const{rightMenuList:g=[],beforeRightClick:K}=e;let x={event:a,items:[]};if(K&&Z(K)){let B=yield K(f,a);Array.isArray(B)?x.items=B:Object.assign(x,B)}else x.items=g;(F=x.items)!=null&&F.length&&(x.items=x.items.filter(B=>!B.hidden),b(x))})}function H(a){s.expandedKeys=a}function Fe(){return s.expandedKeys}function ne(a){s.selectedKeys=a}function Ne(){return s.selectedKeys}function ae(a){s.checkedKeys=a}function Me(){return s.checkedKeys}function le(a){s.checkedKeys=a?P():[]}function G(a){s.expandedKeys=a?E():[]}function Ie(a){s.checkStrictly=a}$(()=>e.searchValue,a=>{a!==p.searchText&&(p.searchText=a)},{immediate:!0}),$(()=>e.treeData,a=>{a&&J(p.searchText)});function J(a){if(a!==p.searchText&&(p.searchText=a),k("update:searchValue",a),!a){p.startSearch=!1;return}const{filterFn:f,checkable:S,expandOnSearch:g,checkOnSearch:K,selectedOnSearch:x}=u(e);p.startSearch=!0;const{title:F,key:B}=u(L),D=[];if(p.searchData=rt(u(A),w=>{var Y,X;const N=f?f(a,w,u(L)):(X=(Y=w[F])==null?void 0:Y.includes(a))!=null?X:!1;return N&&D.push(w[B]),N},u(L)),g){const w=it(p.searchData).map(N=>N[B]);w&&w.length&&H(w)}K&&S&&D.length&&ae(D),x&&D.length&&ne(D)}function Oe(a,f){if(!(!e.clickRowToExpand||!f||f.length===0))if(!s.expandedKeys.includes(a))H([...s.expandedKeys,a]);else{const S=[...s.expandedKeys],g=S.findIndex(K=>K===a);g!==-1&&S.splice(g,1),H(S)}}V(()=>{A.value=e.treeData}),Qe(()=>{const a=parseInt(e.defaultExpandLevel);a>0?s.expandedKeys=i(a):e.defaultExpandAll&&G(!0)}),V(()=>{s.expandedKeys=e.expandedKeys}),V(()=>{s.selectedKeys=e.selectedKeys}),V(()=>{s.checkedKeys=e.checkedKeys}),$(()=>e.value,()=>{s.checkedKeys=R(e.value||[])},{immediate:!0}),$(()=>s.checkedKeys,()=>{const a=R(s.checkedKeys);k("update:value",a),k("change",a)}),V(()=>{s.checkStrictly=e.checkStrictly});const me={setExpandedKeys:H,getExpandedKeys:Fe,setSelectedKeys:ne,getSelectedKeys:Ne,setCheckedKeys:ae,getCheckedKeys:Me,insertNodeByKey:d,insertNodesByKey:o,deleteNodeByKey:r,updateNodeByKey:y,getSelectedNode:Be,checkAll:le,expandAll:G,filterByLevel:a=>{s.expandedKeys=i(a)},setSearchValue:a=>{J(a)},getSearchValue:()=>p.searchText};function $e(a){const{actionList:f}=e;if(!(!f||f.length===0))return f.map((S,g)=>{var x;let K=!0;return Z(S.show)?K=(x=S.show)==null?void 0:x.call(S,a):ve(S.show)&&(K=S.show),K?C("span",{key:g,class:v("action")},[S.render(a)]):null})}const Pe=I(()=>{const a=ee(t.value);return ut(a,(f,S)=>{var se;const g=p.searchText,{highlight:K}=u(e),{title:x,key:F,children:B}=u(L),D=we(f,f.icon),w=At(f,x),N=g?w.indexOf(g):-1,Y=p.startSearch&&!Lt(g)&&K&&N!==-1,X=`color: ${ve(K)?"#f50":K}`,Ue=Y?C("span",{class:(se=u(h))!=null&&se.blockNode?`${v("content")}`:""},[C("span",null,[w.substr(0,N)]),C("span",{style:X},[g]),C("span",null,[w.substr(N+g.length)])]):w,ce=D?C(Nt,{icon:D},null):n.icon?C("span",{class:"mr-1"},[xe(n,"icon")]):null;return f[x]=C("span",{class:`${v("title")} pl-2`,onClick:Oe.bind(null,f[F],f[B])},[n!=null&&n.title?C(z,null,[ce,xe(n,"title",f)]):C(z,null,[ce,Ue,C("span",{class:v("actions")},[$e(f)])])]),f}),a});return T(me),()=>{let a,f;const{title:S,helpMessage:g,toolbar:K,search:x,checkable:F}=e,B=S||K||x||n.headerTitle,D={height:"calc(100% - 38px)"};return C("div",{class:[v(),"h-full",l.class]},[B&&C(Ft,{checkable:F,checkAll:le,expandAll:G,title:S,search:x,toolbar:K,helpMessage:g,onStrictlyChange:Ie,onSearch:J,searchText:p.searchText},be(a=Ke(n))?a:{default:()=>[a]}),C(Ct,{wrapperClassName:u(e.treeWrapperClassName),spinning:u(e.loading),tip:"加载中..."},{default:()=>[ke(C(ot,{style:D},{default:()=>[C(vt,et(u(h),{showIcon:!1,treeData:Pe.value}),be(f=Ke(n,["title"]))?f:{default:()=>[f]})]}),[[ge,!u(c)]]),ke(C(Ce,{image:Ce.PRESENTED_IMAGE_SIMPLE,class:"!mt-4"},null),[[ge,u(c)]])]})])}}});export{Ut as _};
